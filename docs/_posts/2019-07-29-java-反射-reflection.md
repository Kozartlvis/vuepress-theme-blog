---
category: Java
tags:
  - Java
  - 反射
  - Reflection
title: Java 反射(Reflection)
date: '2019-07-29 09:14'
vssue-title: Java 反射(Reflection)
# header-image: /assets/img/header-image-01.jpg
# top: null

---
Java 反射学习记录

<!-- more -->
::: tip 
反射是什么呢？当我们的程序在运行时，需要动态的加载一些类这些类可能之前用不到所以不用加载到 JVM，而是在运行时根据需要才加载，这样的好处对于服务器来说不言而喻。  

举个例子我们的项目底层有时是用 mysql，有时用 oracle，需要动态地根据实际情况加载驱动类，这个时候反射就有用了假设com.java.dbtest.myqlConnection，com.java.dbtest.oracleConnection 这两个类我们要用，这时候我们的程序就写得比较动态化，通过 Class tc = Class.forName("com.java.dbtest.TestConnection"); 通过类的全类名让 JVM 在服务器中找到并加载这个类，而如果是 Oracle 则传入的参数就变成另一个了。这时候就可以看到反射的好处了，这个动态性就体现出 Java 的特性了！  

举多个例子，大家如果接触过 spring，会发现当你配置各种各样的 bean 时，是以配置文件的形式配置的，你需要用到哪些 bean 就配哪些，spring 容器就会根据你的需求去动态加载，你的程序就能健壮地运行。  

:::
<TOC/>
## 反射是什么
反射允许运行中的java程序获取自身的信息，并且可以操作类或对象的内部属性。  

程序中一般的对象都是在编译的时候就确定下来的，而反射可以动态的创建对象并调用其属性。  

反射的核心是JVM在运行时才动态加载类或调用方法,访问属性，不需要在编译期知道运行对象是谁。  

## 反射提供的功能  
1. 在运行时判断任意一个对象所属的类  
2. 在运行时构造任意一个类的对象  
3. 在运行时判断任意一个类所具有的成员变量和方法（通过反射甚至可以调用 private 方法）  
4. 在运行时调用任意一个对象的方法  

## 主要用途 
**反射最重要的用途就是开发各种通用框架**  

很多框架（比如 Spring ）都是配置化的（比如通过 XML 文件配置 JavaBean,Action 之类的），为了保证框架的通用性，它们可能需要根据配置文件加载不同的对象或类，调用不同的方法，这个时候就必须用到反射——运行时动态加载需要加载的对象。  

对与框架开发人员来说，反射虽小但作用非常大，它是各种容器实现的核心。而对于一般的开发者来说，不深入框架开发则用反射用的就会少一点，不过了解一下框架的底层机制有助于丰富自己的编程思想，也是很有益的。  

## 一些使用方法  
1. 调用运行时类本身的 .class 属性  
```java
Class clazz1 = Person.class;
System.out.println(clazz1.getName());
```
2. 通过运行时类的对象获取 getClass();  
```java
Person p = new Person();
Class clazz3 = p.getClass();
System.out.println(clazz3.getName());
```
3. 使用 Class 类的 forName 静态方法  
```java
public static Class<?> forName(String className)
// 在JDBC开发中常用此方法加载数据库驱动:
Class.forName(driver);
```
4. 通过类的加载器 ClassLoader  
```java
ClassLoader classLoader = this.getClass().getClassLoader();
Class clazz5 = classLoader.loadClass(className);
System.out.println(clazz5.getName());
``` 

## 反射的优点   
* **可扩展性** ：应用程序可以利用全限定名创建可扩展对象的实例，来使用来自外部的用户自定义类。  
* **类浏览器和可视化开发环境** ：一个类浏览器需要可以枚举类的成员。可视化开发环境（如 IDE）可以从利用反射中可用的类型信息中受益，以帮助程序员编写正确的代码。  
* **调试器和测试工具** ： 调试器需要能够检查一个类里的私有成员。测试工具可以利用反射来自动地调用类里定义的可被发现的 API 定义，以确保一组测试中有较高的代码覆盖率。  
  
## 反射的缺点  
尽管反射非常强大，但也不能滥用。如果一个功能可以不用反射完成，那么最好就不用。在我们使用反射技术时，下面几条内容应该牢记于心。  

* **性能开销** ：反射涉及了动态类型的解析，所以 JVM 无法对这些代码进行优化。因此，反射操作的效率要比那些非反射操作低得多。我们应该避免在经常被执行的代码或对性能要求很高的程序中使用反射。  

* **安全限制** ：使用反射技术要求程序必须在一个没有安全限制的环境中运行。如果一个程序必须在有安全限制的环境中运行，如 Applet，那么这就是个问题了。  

* **内部暴露** ：由于反射允许代码执行一些在正常情况下不被允许的操作（比如访问私有的属性和方法），所以使用反射可能会导致意料之外的副作用，这可能导致代码功能失调并破坏可移植性。反射代码破坏了抽象性，因此当平台发生改变的时候，代码的行为就有可能也随着变化。  
